"use strict";(self["webpackChunkduetwebcontrol"]=self["webpackChunkduetwebcontrol"]||[]).push([["GamepadJogger"],{"./src/plugins/GamepadJogger/Jogger.vue":function(e,t,s){s.r(t);var o=s("./node_modules/vuetify-loader/lib/loader.js??ruleSet[1].rules[0].use!./node_modules/thread-loader/dist/cjs.js!./node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??ruleSet[1].rules[5]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/plugins/GamepadJogger/Jogger.vue?vue&type=template&id=59bbce00&"),i=s("./src/plugins/GamepadJogger/Jogger.vue?vue&type=script&lang=js&"),n=(s("./src/plugins/GamepadJogger/Jogger.vue?vue&type=style&index=0&id=59bbce00&prod&lang=css&"),s("./node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js")),a=(0,n["default"])(i["default"],o.render,o.staticRenderFns,!1,null,null,null);t["default"]=a.exports},"./src/plugins/GamepadJogger/Jogger.vue?vue&type=style&index=0&id=59bbce00&prod&lang=css&":function(e,t,s){s.r(t);s("./node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-12.use[0]!./node_modules/css-loader/dist/cjs.js??clonedRuleSet-12.use[1]!./node_modules/@vue/vue-loader-v15/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-12.use[2]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/plugins/GamepadJogger/Jogger.vue?vue&type=style&index=0&id=59bbce00&prod&lang=css&")},"./src/plugins/GamepadJogger/Jogger.vue?vue&type=script&lang=js&":function(e,t,s){s.r(t);var o=s("./node_modules/thread-loader/dist/cjs.js!./node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/plugins/GamepadJogger/Jogger.vue?vue&type=script&lang=js&");t["default"]=o["default"]},"./node_modules/mini-css-extract-plugin/dist/loader.js??clonedRuleSet-12.use[0]!./node_modules/css-loader/dist/cjs.js??clonedRuleSet-12.use[1]!./node_modules/@vue/vue-loader-v15/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/dist/cjs.js??clonedRuleSet-12.use[2]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/plugins/GamepadJogger/Jogger.vue?vue&type=style&index=0&id=59bbce00&prod&lang=css&":function(e,t,s){s.r(t)},"./node_modules/thread-loader/dist/cjs.js!./node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/plugins/GamepadJogger/Jogger.vue?vue&type=script&lang=js&":function(e,t,s){s.r(t);s("./node_modules/core-js/modules/es.array.push.js");var o=s("./node_modules/vuex/dist/vuex.esm.js");let i={plugin:0,gcode:1,move:2,custom:3};t["default"]={data:function(){return{actions:[],enabled:!1,gamepadName:"",activeControls:[],showSetAction:!1,settingAction:null,moving:!1,showResetDialog:!1,debug:!1,stepList:[.1,1,5,10,20,50,100],stepIndex:2,feedRateList:[1,5,15,30,60,100],feedRateIndex:3,addNewItem:!1,newEntry:{action:"",command:""},lastAction:0,inputHasFocus:!1,lastKeyPress:0}},created(){window.addEventListener("keydown",this.checkKeyPress),document.addEventListener("focusin",this.inputFocused),document.addEventListener("focusout",this.inputBlurred)},beforeDestroy(){window.removeEventListener("keydown",this.checkKeyPress),document.removeEventListener("focusin",this.inputFocused),document.addEventListener("focusout",this.inputBlurred)},computed:{...(0,o.mapState)("machine/model",["move","state"]),stepValue(){return this.stepList[this.stepIndex]},feedRateValue(){return 60*this.feedRateList[this.feedRateIndex]}},mounted(){this.loadSettings(),setInterval(this.checkGamepad,100)},unmounted(){clearInterval(this.checkGamepad)},methods:{...(0,o.mapActions)("machine",["sendCode"]),buildAction(e,t,s){return{action:e,control:"",type:t,command:s,pressed:!1,key:""}},inputFocused(){this.inputHasFocus=!0},inputBlurred(){this.inputHasFocus=!1},checkKeyPress(e){if(this.showSetAction)return this.settingAction.key=e.key,this.showSetAction=!1,void this.saveSettings();if(!this.inputHasFocus&&Date.now()-this.lastKeyPress>100){this.lastKeyPress=Date.now(),this.actions.forEach((e=>e.pressed=!1));let t=this.actions.filter((t=>t.key===e.key));t[0].pressed=!0,this.fireActions(t),setTimeout((()=>{this.actions.forEach((e=>e.pressed=!1))}),90)}},isActionSet(e){return""!==e.control||""!==e.key},buttonPressed(e){return"object"==typeof e?e.pressed:1==e},setActionDialog(e){this.settingAction=e,this.showSetAction=!0},resetSettings(){this.actions=[],this.move.axes.forEach((e=>{this.actions.push(this.buildAction(`${e.letter}+`,i.move)),this.actions.push(this.buildAction(`${e.letter}-`,i.move))})),this.actions.push(this.buildAction("Home X",i.gcode,"G28 X")),this.actions.push(this.buildAction("Home Y",i.gcode,"G28 Y")),this.actions.push(this.buildAction("Home Z",i.gcode,"G28 Z")),this.actions.push(this.buildAction("Home All",i.gcode,"G28")),this.actions.push(this.buildAction("Step +",i.plugin,"step+")),this.actions.push(this.buildAction("Step -",i.plugin,"step-")),this.actions.push(this.buildAction("Feed Rate +",i.plugin,"feed+")),this.actions.push(this.buildAction("Feed Rate -",i.plugin,"feed-")),this.actions.push(this.buildAction("Set Zero",i.gcode,"G92 X0 Y0 Z0")),this.saveSettings(),this.showResetDialog=!1},clearAction(e){e.control="",e.key=""},loadSettings(){let e=localStorage.getItem("joggerSettings");e?this.actions=JSON.parse(e):this.resetSettings()},saveSettings(){localStorage.setItem("joggerSettings",JSON.stringify(this.actions))},generateGCodeMoveCommand(e){if(this.moving)return;this.moving=!0;let t="";e.forEach((e=>{var s=e.action[0],o="+"===e.action[1]?"":"-",i=`${o}${this.stepValue}`;t+=` ${s}${i}`}));var s=`M120\nG91\nG1 ${t.trim()} F${this.feedRateValue}\nG90\nM121`;this.debug?console.log(s):this.sendCode(s),this.moving=!1},generateGCodeCommand(e){this.moving||"idle"!==this.state.status||(this.debug?console.log(e.command):(this.moving=!0,this.sendCode(e.command),this.moving=!1))},performPluginAction(e){if(!(Date.now()-this.lastAction<500))switch(this.lastAction=Date.now(),e.command){case"step+":this.stepIndex<this.stepList.length-1&&(this.stepIndex++,this.sendCode(`M117 "Jogger Step :  ${this.stepValue}"`));break;case"step-":this.stepIndex>0&&(this.stepIndex--,this.sendCode(`M117 "Jogger Step :  ${this.stepValue}"`));break;case"feed+":this.feedRateIndex<this.feedRateList.length-1&&(this.feedRateIndex++,this.sendCode(`M117 "Jogger Feed Rate :  ${this.feedRateList[this.feedRateIndex]}"`));break;case"feed-":this.feedRateIndex>0&&this.feedRateIndex--,this.sendCode(`M117 "Jogger Feed Rate :  ${this.feedRateList[this.feedRateIndex]}"`);break}},checkGamepad(){var e=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];if(e.length>0&&e[0]){this.gamepadName=e[0].id;let t=e[0];if(this.activeControls=[],t.buttons.forEach(((e,t)=>{this.buttonPressed(e)&&this.activeControls.push(`B${t}`)})),this.activeAxes="",t.axes.forEach(((e,t)=>{if(1-Math.abs(e)<.5){let s=e>0?"+":"-";this.activeControls.push(`A${t}${s}`)}})),this.actions.forEach((e=>e.pressed=!1)),this.settingAction&&this.activeControls.length>0)this.settingAction.control=this.activeControls[0],this.settingAction=null,this.showSetAction=!1,this.saveSettings();else if(this.activeControls.length>0){let e=new Array;this.activeControls.forEach((t=>{e.push(...this.actions.filter((e=>e.control===t)))})),e.forEach((e=>e.pressed=!0)),this.debug&&console.log(e),this.fireActions(e)}}},fireActions(e){if(!this.enabled)return;let t=e.filter((e=>e.type===i.move));if(t.length>0)return void this.generateGCodeMoveCommand(t);let s=e.filter((e=>e.type===i.gcode||e.type===i.custom));if(s.length>0)return void this.generateGCodeCommand(s[0]);let o=e.filter((e=>e.type===i.plugin));o.length>0&&this.performPluginAction(o[0])},addCustomAction(e,t){this.actions.push(this.buildAction(e,i.custom,t)),this.saveSettings(),this.newEntry.action="",this.newEntry.command="",this.addNewItem=!1},removeCustomAction(e){this.actions.splice(e,1),this.saveSettings()}}}},"./src/plugins/GamepadJogger/index.js":function(e,t,s){s.r(t);var o=s("./src/routes/index.ts"),i=s("./src/plugins/GamepadJogger/Jogger.vue");(0,o.registerRoute)(i["default"],{Settings:{Jogger:{icon:"mdi-gamepad-variant",caption:"Jogger",path:"/Jogger"}}})},"./node_modules/vuetify-loader/lib/loader.js??ruleSet[1].rules[0].use!./node_modules/thread-loader/dist/cjs.js!./node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!./node_modules/@vue/vue-loader-v15/lib/loaders/templateLoader.js??ruleSet[1].rules[5]!./node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./src/plugins/GamepadJogger/Jogger.vue?vue&type=template&id=59bbce00&":function(e,t,s){s.r(t),s.d(t,{render:function(){return g},staticRenderFns:function(){return p}});var o=s("./node_modules/vuetify/lib/components/VBtn/VBtn.js"),i=s("./node_modules/vuetify/lib/components/VBtnToggle/VBtnToggle.js"),n=s("./node_modules/vuetify/lib/components/VCard/VCard.js"),a=s("./node_modules/vuetify/lib/components/VCard/index.js"),d=s("./node_modules/vuetify/lib/components/VGrid/VCol.js"),l=s("./node_modules/vuetify/lib/components/VDialog/VDialog.js"),r=s("./node_modules/vuetify/lib/components/VForm/VForm.js"),u=s("./node_modules/vuetify/lib/components/VGrid/VRow.js"),c=s("./node_modules/vuetify/lib/components/VDataTable/VSimpleTable.js"),h=s("./node_modules/vuetify/lib/components/VSwitch/VSwitch.js"),m=s("./node_modules/vuetify/lib/components/VTextField/VTextField.js"),v=s("./node_modules/vuetify/lib/components/VTextarea/VTextarea.js"),g=function render(){var e=this,t=e._self._c;return t("div",[t("div",[e._v("Gamepad Name : "+e._s(e.gamepadName))]),t("div",[t(h["default"],{attrs:{inset:"",label:"Enable"},model:{value:e.enabled,callback:function(t){e.enabled=t},expression:"enabled"}})],1),t(u["default"],[t(d["default"],{attrs:{cols:"6"}},[e._v(" Steps"),t("br"),t(i["default"],{attrs:{mandatory:"",exclusive:""},model:{value:e.stepIndex,callback:function(t){e.stepIndex=t},expression:"stepIndex"}},e._l(e.stepList,(function(s){return t(o["default"],{key:s},[e._v(" "+e._s(s))])})),1)],1),t(d["default"],{attrs:{cols:"6"}},[e._v(" Feed Rate (mm/s)"),t("br"),t(i["default"],{attrs:{mandatory:"",exclusive:""},model:{value:e.feedRateIndex,callback:function(t){e.feedRateIndex=t},expression:"feedRateIndex"}},e._l(e.feedRateList,(function(s){return t(o["default"],{key:s},[e._v(" "+e._s(s))])})),1)],1)],1),t(c["default"],[t("thead",[t("tr",[t("td",[t("h2",[e._v("Configuration")])]),t("td",{staticClass:"cell-right",attrs:{colspan:"4"}},[t(o["default"],{staticClass:"mr-2",on:{click:function(t){e.addNewItem=!0}}},[e._v("New Action")]),t(o["default"],{attrs:{color:"red"},on:{click:function(t){e.showResetDialog=!0}}},[e._v("Reset")])],1)]),t("tr",[t("th",[e._v("Action")]),t("th",[e._v("Set")]),t("th",[e._v("Configure")]),t("th",[e._v("Custom Command")]),t("th",[e._v("Controller Button Id")]),t("th",[e._v("Keyboard Key")])])]),t("tbody",e._l(e.actions,(function(s,i){return t("tr",{key:i,staticClass:"action-control",class:{"action-pressed":s.pressed}},[t("td",[e._v(e._s(s.action))]),t("td",[e._v(e._s(e.isActionSet(s)))]),t("td",[t(o["default"],{staticClass:"mr-1",attrs:{color:"info"},on:{click:function(t){return e.setActionDialog(s)}}},[e._v("Set")]),t(o["default"],{staticClass:"mr-1",attrs:{color:"warning"},on:{click:function(t){return e.clearAction(s)}}},[e._v("Clear")]),t(o["default"],{directives:[{name:"show",rawName:"v-show",value:3===s.type,expression:"action.type === 3"}],attrs:{color:"error"},on:{click:function(t){return e.removeCustomAction(i)}}},[e._v("Delete")])],1),t("td",[t("span",{directives:[{name:"show",rawName:"v-show",value:3===s.type,expression:"action.type === 3"}]},[e._v(e._s(s.command))])]),t("td",[e._v(e._s(s.control))]),t("td",[e._v(e._s(s.key))])])})),0)]),t(l["default"],{attrs:{"max-width":"325"},model:{value:e.showSetAction,callback:function(t){e.showSetAction=t},expression:"showSetAction"}},[t(n["default"],[t(a.VCardTitle,[e._v("Set Action")]),t(a.VCardText,[e._v("Press a button or move an axis to set value")]),t(a.VCardActions,[t(o["default"],{on:{click:function(t){e.showSetAction=!e.showSetAction}}},[e._v("Cancel")])],1)],1)],1),t(l["default"],{attrs:{"max-width":"325"},model:{value:e.showResetDialog,callback:function(t){e.showResetDialog=t},expression:"showResetDialog"}},[t(n["default"],{attrs:{"max-width":"325",outlined:""}},[t(a.VCardTitle,[e._v("Reset Settings")]),t(a.VCardText,[e._v("Click reset to confirm reset.")]),t(a.VCardActions,[t(o["default"],{attrs:{color:"red",width:"150"},on:{click:e.resetSettings}},[e._v("Reset")]),e._v(" "),t(o["default"],{attrs:{color:"info",width:"150"},on:{click:function(t){e.showResetDialog=!1}}},[e._v("Cancel")])],1)],1)],1),t(l["default"],{attrs:{"max-width":"325"},model:{value:e.addNewItem,callback:function(t){e.addNewItem=t},expression:"addNewItem"}},[t(n["default"],[t(a.VCardTitle,[e._v("Add New Action")]),t(a.VCardText,[t(r["default"],[t(m["default"],{attrs:{label:"Action Name"},model:{value:e.newEntry.action,callback:function(t){e.$set(e.newEntry,"action",t)},expression:"newEntry.action"}}),t(v["default"],{attrs:{label:"Command","auto-grow":"",filled:""},model:{value:e.newEntry.command,callback:function(t){e.$set(e.newEntry,"command",t)},expression:"newEntry.command"}}),t(o["default"],{on:{click:function(t){return e.addCustomAction(e.newEntry.action,e.newEntry.command)}}},[e._v("Save")]),t(o["default"],{on:{click:function(t){e.addNewItem=!1}}},[e._v("Close")])],1)],1)],1)],1)],1)},p=[]}}]);
//# sourceMappingURL=GamepadJogger.78aac7fc.js.map